<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kidney Disease Classification</title>
<link rel="icon" href="https://img.icons8.com/color/48/kidney.png" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
<style>
    body {
        background-color: #eff2f9;
        font-family: 'Segoe UI', Arial, sans-serif;
        min-height: 100vh;
        text-align: center;
        padding-top: 30px;
    }
    h3 {
        color: #1b2d6b;
        font-weight: 700;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 30px;
        margin-bottom: 30px;
    }
    h3 img {
        height: 40px;
        margin-right: 10px;
    }
    .image-part {
        width: 320px;
        height: 320px;
        border: 3px solid #31a9b8;
        margin: 0 auto 18px;
        border-radius: 12px;
        background: #f2fafd;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .image-part img {
        max-height: 300px;
        max-width: 280px;
        border-radius: 8px;
        object-fit: contain;
    }
    .btn-part {
        width: 320px;
        margin: 0 auto 20px;
        display: flex;
        justify-content: space-between;
    }
    button {
        width: auto;
        min-width: 120px;
        font-weight: 600;
        cursor: pointer;
    }
    #uload {
        background-color: #007bff;
        border: 1px solid #007bff;
        color: #fff;
    }
    #uload:hover {
        background-color: #0056b3;
        border-color: #0056b3;
        color: #fff;
    }
    #send {
        background-color: #28a745;
        border: 1px solid #28a745;
        color: #fff;
    }
    #send:hover {
        background-color: #1e7e34;
        border-color: #1e7e34;
        color: #fff;
    }
    #fileinput {
        display: none;
    }
    #result {
        font-size: 2rem;
        font-weight: 700;
        color: #1b2d6b;
        min-height: 3rem;
        margin-top: 20px;
    }
    .footer {
        position: fixed;
        bottom: 0;
        width: 100%;
        background: #f2fafd;
        color: #1b2d6b;
        font-weight: 400;
        font-size: 1.1rem;
        padding: 12px 0;
        box-shadow: 0 -2px 12px #e0eafc;
    }
    #loading {
        display: none;
        position: fixed;
        left: 0; top: 0;
        width: 100%; height: 100%;
        background: rgba(255,255,255,0.7);
        z-index: 9999;
    }
    .loader {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #363e75;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        position: absolute;
        top: 50%; left: 50%;
        margin: -30px 0 0 -30px;
        animation: spin 2s linear infinite;
    }
    @keyframes spin {
        0% {transform: rotate(0deg);}
        100% {transform: rotate(360deg);}
    }
</style>
</head>
<body>
    <h3><img src="https://img.icons8.com/color/48/kidney.png" alt="Kidney icon"> Kidney Disease Classification</h3>
    <div class="image-part">
        <img id="photo" src="https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?q=80&w=870&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Sample Kidney Image" />
    </div>
    <div class="btn-part">
        <button id="uload">Upload</button>
        <button id="send">Predict</button>
        <input type="file" id="fileinput" accept="image/*" />
    </div>
    <div id="result"></div>
    <div id="loading"><div class="loader"></div></div>
    <div class="footer">Developed by Aditya Chandel</div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
        var base_data = "";

        $("#uload").click(function() {
            $("#fileinput").trigger("click");
        });

        $("#fileinput").change(function() {
            if(this.files && this.files[0]){
                var reader = new FileReader();
                reader.onload = function(e){
                    var img = new Image();
                    img.crossOrigin = "Anonymous";
                    img.onload = function(){
                        var canvas = document.createElement('canvas');
                        var ctx = canvas.getContext('2d');
                        canvas.width = this.width;
                        canvas.height = this.height;
                        ctx.drawImage(this, 0, 0);
                        base_data = canvas.toDataURL('image/jpeg', 1.0).replace(/^data:image.+;base64,/, '');
                        canvas = null;
                    }
                    img.src = e.target.result;
                    $("#photo").attr("src", e.target.result);
                }
                reader.readAsDataURL(this.files[0]);
            }
        });

        $("#send").click(function(){
            if(!base_data){
                alert("Please upload an image first!");
                return;
            }
            $("#result").text("Predicting...");
            $("#loading").show();
            $.ajax({
                url: "/predict",
                type: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                data: JSON.stringify({ image: base_data }),
                success: function(res){
                    $("#loading").hide();
                    if(Array.isArray(res) && typeof res[0] === "string"){
                        $("#result").text(res[0]);
                    } else if(res.result){
                        $("#result").text(res.result);
                    } else {
                        $("#result").text("Prediction failed.");
                    }
                },
                error: function(){
                    $("#loading").hide();
                    $("#result").text("Prediction failed.");
                }
            });
        });
    </script>
</body>
</html>
